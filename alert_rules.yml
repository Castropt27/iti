groups:
  - name: flask_app_alerts
    interval: 30s
    rules:
      # Escala por Throughput de Rede (cAdvisor)
      - alert: ScaleUpNetworkThroughput
        expr: |
          sum(
            rate(container_network_receive_bytes_total{container_label_com_docker_compose_service="flask-app",interface="eth0"}[1m])
          ) + sum(
            rate(container_network_transmit_bytes_total{container_label_com_docker_compose_service="flask-app",interface="eth0"}[1m])
          ) > 5000
        for: 1m
        labels:
          severity: scaleup
        annotations:
          summary: "Throughput de rede elevado nos Flask apps"
          description: "Total RX+TX > 5KB/s por 2m. Considerar adicionar réplicas. Valor: {{ $value }} B/s"

      # (Opcional) Escala para baixo quando tráfego está baixo
      - alert: ScaleDownNetworkThroughput
        expr: |
          sum(
            rate(container_network_receive_bytes_total{container_label_com_docker_compose_service="flask-app",interface="eth0"}[2m])
          ) + sum(
            rate(container_network_transmit_bytes_total{container_label_com_docker_compose_service="flask-app",interface="eth0"}[2m])
          ) < 5000
        for: 1m
        labels:
          severity: scaledown
        annotations:
          summary: "Throughput de rede baixo nos Flask apps"
          description: "Total RX+TX < 2KB/s por 10m. Considerar remover réplicas. Valor: {{ $value }} B/s"
          value: "{{ $value }}"
     